<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">
		<link rel="stylesheet" href="../public/styles/main.css">
		<title>Sh0ckFR's Website | CyberPunk, Born in the binary world of the computer security</title>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col">
					<div id="left-menu">
						<h3><span class="text-green">>></span> <span class="text-red">Red</span>-Team</h3>
						<a href="https://sh0ckfr.com/pages/introduction-syswhispers.html">Introduction à Syswhispers1 et Syswhispers2</a><br />
						<a href="https://sh0ckfr.com/pages/les-differences-entre-red-team-et-pentest.html">Les différences entre Red Team et Pentest</a><br />
						<hr />
						<h3><span class="text-green">>></span> <span class="text-blue">Blue</span>-Team</h3>
						Rien pour le moment
					</div>
				</div>
				<div class="col-lg-10">
					<div class="row">
						<div id="logo">
							<a href="https://twitter.com/Sh0ckFR" target="_blank"><img class="rounded-circle" src="../public/pictures/logo.jpg" alt="Sh0ckFR logo" /></a>
							<a href="https://sh0ckfr.com/" target="_blank">
								<div class="stack" style="--stacks: 3;">
									<span style="--index: 0;">Sh0ck<span class="text-red">FR</span>'s Website</span>
									<span style="--index: 1;">Sh0ck<span class="text-red">FR</span>'s Website</span>
									<span style="--index: 2;">Sh0ck<span class="text-red">FR</span>'s Website</span>
								</div>
							</a>
						</div>
					</div>
					<div class="row">
						<a href="/"><span class="text-green"><< home</span></a>
						<h1>Les différences entre Red Team et Pentest</h1>
						<p>
							Qui n'a jamais entendu autour de lui "Je fais du Red Team, du vrai Red Team !" ?

							Cette phrase, je l'ai souvent entendu dans des conférences, des soirées infosec et j'en passe, là où il fallait placer Red Team dans une conversation, à coup sûr ça faisait mouche.

							Mais qu'en est-il vraiment ? est-ce du pentest ? est-ce que le pentest peut être considéré comme Red Team ? cet article n'a pas vocation à être technique et a pour but de démystifier la chose et expliquer clairement ce qu'il en est.
						</p>
						<h2>La <span class="text-red">Red</span> Team</h2>
						<p>
							La Red Team est une équipe composée de plusieurs membres dont les tâches peuvent être diverses et dont l'objectif est de tester principalement le temps de réponse des équipes de sécurité défensives <mark>(SOC - Blue Team)</mark>.

							Elle doit penser à varier ses <mark>TTPs (Tactics, Techniques & Procedures)</mark> et donc innover et proposer de nouvelles charges malveillantes pouvant contourner les mesures en place pour challenger ces équipes.

							Voici une liste de tâche que nous retrouvons la plupart du temps dans un premier temps durant un exercice Red Team :
						</p>
<pre><code class="language-text">
- Reconnaissance sur les réseaux sociaux
- Reconnaissance sur les assets exposés sur Internet sans interaction directe (i.e : Shodan, ZoomEye, Certificate Transparency etc...)
- Mise en place de l'infrastructure (C2)
- Achat de domaines catégorisés ou catégorisation de domaines "neutres"
- Préparation des templates de phishing
- Préparation des mails de catégorisation
- Préparation des mails de phishing
- Développement de payloads
</code></pre>
						<p>
							Cette première étape est considérée comme une activité dite <mark>passive</mark>, il s'agit simplement de mettre en place les outils nécessaires à l'exercice Red Team et faire de la reconnaissance pour mieux connaître la cible de la mission.

							Cette partie n'est pas à négliger car elle nécessite un temps plutôt conséquent notamment sur le côté <mark>R&D</mark>, il faut maintenir les outils permettant de mettre en place l'infrastructure, développer des <mark>payloads (charges malveillantes)</mark> permettant de contourner des antivirus et <mark>EDR (Endpoint Detection & Response)</mark> mais également de créer de faux comptes sur les réseaux sociaux et les entretenir.

							Dans un second temps, l'équipe Red Team passe dans un mode d'activité dite <mark>semi-offensive</mark>, il s'agit en réalité d'envoyer des mails de catégorisation, ces mails ne contiennent pas encore les charges malveillantes mais seulement une image ou un lien vers l'infrastructure de la Red Team.

							Ils ont un but précis, ils vont permettre à l'équipe de savoir différentes choses :
						</p>
<pre><code class="language-text">
- Est-ce qu'une passerelle mail bloque la réception des mails via un antivirus ou une règle particulière ? 
- Notre domaine est-il bien catégorisé et non filtré ?
- Notre mail finit-il dans les spams ?
- Un équipement réseau bloque t'il la réception ?
- Est-ce que le proxy sortant filtre la sortie vers notre infrastructure ?
- Quel est le type de client mail, sa version, son user-agent ?
</code></pre>
						<p>
							Une fois que la Red Team a pu obtenir une première communication via ces mails de catégorisation, celle-ci va pouvoir passer dans sa phase <mark>offensive</mark>.

							Elle procéde donc à une reconnaissance active sur les assets exposés comme du scan de ports ouverts, de la recherche de vulnérabilités pouvant être exploitées, du password spraying sur les services exposés pour repérer des mots de passes faibles ou des mots de passes par défaut par exemple.

							Si un accès a été repéré, il est à ce moment-là utilisé pour mettre en place les charges malveillantes, sinon les charges sont envoyées à la cible par mail, cela peut être sous différentes formes, un exécutable, un fichier doc, un fichier hta etc....

							Si la charge malveillante est exécutée par la cible et qu'un premier beacon ou implant est disponible pour la Red Team, elle passe dans un mode de reconnaissance interne du réseau.

							À ce moment-là, plusieurs possibilités s'offrent à la Red Team :
						</p>
<pre><code class="language-text">
- Reconnaissance via des requêtes LDAP (BloodHound, PowerView, LDAPSearch)
- Reconnaissance sur les partages réseaux
- Reconnaissance sur les ranges d'adresses IP (services accessibles en Interne)
- Reconnaissance sur le poste de l'utilisateur concerné (des mots de passes sont-il présents ou autre information essentielle ?)
etc...
</code></pre>
						<p>
							Ces informations permettent ensuite à la Red Team de rebondir sur le réseau via des mouvements latéraux jusqu'à remplir les objectifs de la mission qui peuvent être variés (compromission d'un poste ou d'un serveur en particulier, devenir admin de domaine, prouver qu'il est possible de détourner de l'argent, réaliser une simulation d'attaque de type Ransomware et bien d'autres).

							Et là vous allez me dire "Oui mais tout ça c'est du pentest interne ?".

							<img src="../public/pictures/cat-sad.jpg" alt="Cat Sad" />

							Urgh, à ce moment-là, je risque grincer des dents, pour plusieurs raisons :
						</p>
<pre><code class="language-text">
- Durant un exercice Red Team, les équipes de sécurité ne sont pas au courant de celui-ci, en pentest, elles le sont
- Le périmètre définit en pentest est très souvent plus petit qu'un périmètre Red Team
- Une Red Team va chercher à aller d'un point A à un point B et remontera essentiellement les vulnérabilités sur ce chemin
- Un pentester va lui, devoir remonter des vulnérabilités de façon générale sur un périmètre définit en testant différents chemins
- Un pentester n'aura souvent pas besoin de réaliser de l'ingénierie sociale sur les réseaux sociaux sauf sur prestation dédiée
- Enfin, une White Team que je mentionnerais plus bas n'est pas nécessaire lors d'un pentest
</code></pre>
						<p>
							Vous l'aurez donc compris, un exercice Red Team n'est pas un pentest, et il serait intéressant que ce terme ne soit plus utilisé à outrance.

							Enfin, contrairement à un pentest, une équipe peut être amenée à effectuer des tests d'intrusion physique en plus d'une intrusion dans un système d'information.

							Cela implique du coup plus de préparation, l'objectif étant à ce moment-là pour la Red Team de réussir à rentrer physiquement dans un bâtiment en trouvant des <mark>légendes</mark> (prétextes pour effectuer de l'ingénierie sociale afin de réussir à poser un implant physique dans le bâtiment sans dévoiler son identité d'opérateur Red Team).

							Bien sûr, pour garantir la sécurité physique de l'opérateur Red Team, une fiche de mission doit être fournie à celui-ci qui atteste qu'il s'agit bien d'un exercice Red Team, la date de l'exercice, sa durée ainsi que son périmètre (adresses des bâtiments concernés).

							Cela permet notamment d'éviter qu'une personne de l'équipe se retrouve en garde à vue, la mésaventure est arrivée à deux consultants en 2019 : <a class="link" href="https://portswigger.net/daily-swig/coalfire-arrests-charges-against-us-pen-testers-finally-dropped" target="_blank">https://portswigger.net/daily-swig/coalfire-arrests-charges-against-us-pen-testers-finally-dropped</a>
						</p>
						<h2>La <span class="text-blue">Blue</span> Team</h2>
						<p>
							La Blue Team a pour mission lors d'un exercice Red Team, de détecter les méthodes utilisées par la Red Team, et de réaliser une réponse à incident en cas de détection comme si c'était un attaquant réel.

							Durant un exercice Red Team, la Blue Team n'est pas mise dans la confidence, elle ne sait donc pas qu'un exercice peut se dérouler à tout moment.

							Une bonne Blue Team est une équipe qui va donc être disponible en permanence 24h/24 et 7 jours sur 7 pour monitorer ce qu'il se passe sur le réseau et notamment sur l'<mark>Active Directory</mark>.

							Elle est souvent composée de deux composantes majeures :
						</p>
<pre><code class="language-text">
- Le CERT (Computer Emergency Response Team) ou CISRT (Computer Security Incident Response Team)
- Un SOC (Security Operations Center)
</code></pre>
						<p>
							Le CERT/CISRT a pour mission d'anticiper les incidents de sécurité via des activités de renseignements sur les menaces ainsi que les acteurs malveillants.

							Il a aussi pour mission de remédier aux incidents de sécurité du <mark>SI (Système d'Information)</mark>, intervenir dans leur résolution et également de partager une veille technologique sécurité sur les actualités cyber et sur les vulnérabilités.

							La plupart des CERTs en France peuvent demander à rejoindre une communauté nommée <a class="link" href="https://www.cert.ssi.gouv.fr/csirt/intercert-fr/" target="_blank">InterCERT France</a> et ainsi échanger des informations sur les menaces potentielles.

							Un SOC est quant à lui, une équipe de sécurité chargée de surveiller et d'analyser en permanence le Système d'Information, et d'intervenir en cas d'incidents, contrairement à un CERT, il n'a pas pour vocation à se renseigner sur des groupes d'attaquants mais c'est à lui de faire remonter les informations d'un incident au CERT.

							Pour détecter des événements anormaux, cette équipe possède plusieurs outils notamment des EDR mentionnés plus haut qui permettent de détecter des actions malveillantes réalisés sur un poste de travail comme :
						</p>
<pre><code class="language-text">
- Des injections suspicieuses dans un processus
- Des modifications dans le registre Windows
- La mise en place de moyens de persistance (tâches planifiées par exemple)
- Des modifications suspectes de fichiers
- Des dumps mémoire
- Un enchaînement de comportements suspects sur le poste
etc...
</code></pre>
						<p>
							La Blue Team possède également des sondes réseaux <mark>IPS (Intrusion Prevention System)</mark> et <mark>IDS (Intrusion Detection System)</mark> qui sont généralement reliées à un <mark>SIEM (Security Information and Event Management)</mark>.

							Un SIEM est un outil permettant de collecter et d'agrèger des données, la plupart du temps, il s'agit de logs de tous les équipements réseaux, postes de travail, serveurs que la Blue Team a jugée utile de monitorer.

							Cet outil permettant comme vous l'aurez sans doute deviné, est d'observer le réseau via une interface permettant de faire des recherches précises et de mettre également en place des règles de détection.

							Ces règles sont souvent basées sur les TTPs (Tactics, techniques and procedures) d'acteurs malveillants et répertoriées par la communauté <a class="link" href="https://attack.mitre.org/" target="_blank">https://attack.mitre.org/</a> souvent implémentées dans les outils vendus actuels, ou bien définies par l'équipe Blue Team elle même.

							Elles permettent de détecter plusieurs actions comme par exemple :
						</p>
<pre><code class="language-text">
- Des scans réseaux offensifs
- Utilisation d'exploits publics et connus
- Des comptes compromis ou des tentatives de compromission
- La mise en place de moyens de persistance
- Une élévation de privilèges
- Un contournement de permissions
- Un mouvement latéral
- Une communication vers un C2
etc...
</code></pre>
						<p>
							Si la Blue Team détecte un exercice Red Team, à ce moment-là, l'exercice peut se transformer en <mark>Assume Breach</mark>, cela veut dire que l'exercice Red Team peut continuer en partant du principe qu'un attaquant a pu accéder au réseau interne.

							L'Assume Breach peut être aussi considéré comme du Purple Team, la Red Team doit mettre en évidence les vulnérabilités majeures et la Blue Team doit de son côté continuer à observer la Red Team tout en prélevant des traces de compromission ou d'événements.

							Certains diront que le Purple Team doit être une équipe à part entière en plus de l'équipe Red Team et Blue Team, ce n'est souvent pas le cas dans la réalité car il est très simple pour une Red Team et une Blue Team de communiquer ensemble sans avoir besoin d'une équipe intermédiaire dédiée à ça.

							Que ça soit en mode Assume Breach ou sans avoir détectée la Red Team, le rôle de la Blue Team en fin de mission est de fournir tous les éléments en sa possession à la Red Team et à la White Team pour lister ce qui a et n'a pas été identifié durant l'exercice et ainsi améliorer les capacités de détection.
						</p>
						<h2>La White Team</h2>
						<p>
							<img src="../public/pictures/white-team.jpg" alt="White Team" />

							La White Team est souvent composée d'une ou plusieurs personnes côté Blue Team et/ou de personnes du Management ainsi que d'une personne côté Red Team qui auront pour rôle d'encadrer l'exercice.

							Ces personnes sont donc au courant de l'exercice ainsi que des actions réalisées des deux côtés, que cela soit côté Blue ou côté Red, si la Red Team va trop loin, cette équipe devra à ce moment-là l'indiquer à la Red Team.

							Les personnes de la White Team qui sont Blue à l'origine, ne doivent pas communiquer qu'un exercice est en cours aux autres personnes Blue qui ne sont pas dans la White Team.

							Ainsi, les personnes de la White Team peuvent définir les limites de l'exercice mais également donner des incides à la Red Team si cela est nécessaire pour gagner du temps.

							Imaginons, la Red Team a découvert un chemin de compromission sur l'Active Directory, au lieu de perdre 2 jours ou plus à identifier les machines intéressantes pour l'exercice, la White Team pourra communiquer à la Red Team où se trouve ces machines, dans quelle forêt de l'AD par exemple.

							Tout ce que j'ai pu expliquer ici, se retrouve notamment dans la documentation <mark>TIBER-EU</mark> disponible ici : <a class="link" href="https://www.ecb.europa.eu/paym/cyber-resilience/tiber-eu/html/index.en.html">https://www.ecb.europa.eu/paym/cyber-resilience/tiber-eu/html/index.en.html</a>
						</p>
						<h2>Tableau comparatif Red Team / Pentest</h2>
						<p>
							<table class="table">
								<thead>
									<tr>
										<th scope="col"></th>
										<th scope="col">Red Team</th>
										<th scope="col">Pentest</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<th scope="row">La Blue Team est au courant de l'exercice ?</th>
										<td>Non</td>
										<td>Oui</td>
									</tr>
									<tr>
										<th scope="row">Le périmètre durant l'exercice est ?</th>
										<td>Plus grand</td>
										<td>Plus petit</td>
									</tr>
									<tr>
										<th scope="row">Comment sont remontées les vulnérabilités ?</th>
										<td>Remontées en allant d'un point A à un point B</td>
										<td>Remontées sur tout le scope définit</td>
									</tr>
									<tr>
										<th scope="row">L'exercice a t'il besoin d'ingénierie sociale sur les réseaux sociaux ?</th>
										<td>Oui</td>
										<td>Non</td>
									</tr>
									<tr>
										<th scope="row">Une White Team est-elle nécessaire à l'exercice ?</th>
										<td>Oui</td>
										<td>Non</td>
									</tr>
								</tbody>
							</table>
						</p>
						<h2>Mot de la fin</h2>
						<p>
							J'espère que cet article a pu être le plus clair possible, et qu'il a pu vous donner une vision d'ensemble sur ce qui est réalisé durant un exercice Red Team.

							Le Red Team comme vous avez pu le voir demande une plus grande préparation qu'un pentest et les missions durent souvent plusieurs semaines jusqu'à 2 ou 3 mois pour les missions classiques.

							Cela ne veut pas dire qu'un Pentest est moins important qu'un exercice Red Team, les deux ont des objectifs différents et se complètent pour améliorer la sécurité d'une entreprise.

							Il est important de préciser qu'un exercice Red Team est réalisé à la suite de pentests internes et que la cible a normalement atteint un niveau de maturité pour se prêter à l'exercice.

							En France, ces exercices se développent au fur et à mesure mais les entreprises ne connaissent pas bien la différence ou ne voient pas un réel intérêt d'avoir une Red Team.

							Cet article a pour but d'inciter les entreprises à développer ce domaine qui est pour ma part fondamental pour obtenir un degré de maturité au niveau de la sécurité de leur système d'information.
						</p>
						<h4>Crédits</h4>
						<p>
							Cet article est en mémoire à <a class="link" href="https://www.nouvelobs.com/rue89/rue89-internet/20111207.RUE6282/hommage-au-hacker-paulo-pinto-alias-crashfr.html" target="_blank">CrashFR</a> qui a passé son vivant à démystifier son domaine.

							Un grand merci à Ottersec (@ottersecx) pour la relecture de cet article <a class="link" href="https://twitter.com/ottersecx" target="_blank">https://twitter.com/ottersecx</a>
						</p>
						<hr />
					</div>
				</div>
			</div>
		</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
	<script>hljs.highlightAll();</script>
	</body>
</html>
